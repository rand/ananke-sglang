# Default values for sglang-ananke
# This is a YAML-formatted file.

# =============================================================================
# Image Configuration
# =============================================================================
image:
  repository: lmsysorg/sglang
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: []

# =============================================================================
# Model Configuration
# =============================================================================
model:
  # HuggingFace model path or local path
  path: "meta-llama/Llama-3.1-8B-Instruct"

  # HuggingFace token for gated models (use existingSecret for production)
  hfToken: ""

  # Use existing secret for HF token
  # existingSecret:
  #   name: hf-token
  #   key: token

# =============================================================================
# Model Volume Configuration
# =============================================================================
modelVolume:
  # Enable persistent volume for model cache
  enabled: true

  # Volume type: pvc, hostPath, emptyDir
  type: pvc

  # PVC configuration
  pvc:
    size: 100Gi
    storageClassName: ""
    accessModes:
      - ReadWriteOnce
    # Use existing PVC
    existingClaim: ""

  # hostPath configuration (for single-node deployments)
  hostPath:
    path: /data/models
    type: DirectoryOrCreate

  # Mount path inside container
  mountPath: /root/.cache/huggingface

# =============================================================================
# Ananke Backend Configuration
# =============================================================================
ananke:
  # Enable Ananke backend
  enabled: true

  # Target programming language
  # Options: python, typescript, go, rust, kotlin, swift, zig
  language: "python"

  # Maximum rollback history in tokens
  maxRollbackTokens: 200

  # Enabled constraint domains (comma-separated)
  # Options: syntax, types, imports, controlflow, semantics
  # Empty means all domains enabled
  enabledDomains: ""

  # Default constraint spec (JSON string)
  defaultConstraintSpec: ""

# =============================================================================
# Server Configuration
# =============================================================================
server:
  # Server port
  port: 30000

  # Tensor parallelism (GPUs per replica)
  tpSize: 1

  # Memory fraction for KV cache
  memFraction: 0.9

  # Log level
  logLevel: INFO

  # Enable metrics endpoint
  enableMetrics: true

  # Additional server arguments
  extraArgs: []

# =============================================================================
# Deployment Configuration
# =============================================================================
replicaCount: 1

# Use StatefulSet instead of Deployment (for stable network identities)
useStatefulSet: false

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext: {}

# Container security context
securityContext:
  privileged: true  # Required for RDMA

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# =============================================================================
# Resource Configuration
# =============================================================================
resources:
  limits:
    nvidia.com/gpu: 1
    memory: 40Gi
  requests:
    nvidia.com/gpu: 1
    cpu: 2
    memory: 16Gi

# Node selector
nodeSelector: {}
#   cloud.google.com/gke-accelerator: nvidia-tesla-a100

# Tolerations
tolerations: []
#   - key: "nvidia.com/gpu"
#     operator: "Exists"
#     effect: "NoSchedule"

# Affinity
affinity: {}

# =============================================================================
# Health Checks
# =============================================================================
healthCheck:
  liveness:
    path: /health
    initialDelaySeconds: 120
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 3

  readiness:
    path: /health_generate
    initialDelaySeconds: 120
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 1

# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  port: 80
  annotations: {}

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: sglang.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: sglang-tls
  #    hosts:
  #      - sglang.local

# =============================================================================
# Autoscaling Configuration
# =============================================================================
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 4
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

  # Custom metrics (requires Prometheus Adapter)
  customMetrics: []
  #   - type: Pods
  #     pods:
  #       metric:
  #         name: sglang_requests_queued
  #       target:
  #         type: AverageValue
  #         averageValue: 10

# =============================================================================
# Monitoring Configuration
# =============================================================================
monitoring:
  # ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
    additionalLabels: {}

  # PrometheusRule for alerting
  prometheusRule:
    enabled: false
    namespace: ""
    additionalLabels: {}

# =============================================================================
# Network Policy
# =============================================================================
networkPolicy:
  enabled: false
  ingress: []
  egress: []

# =============================================================================
# Extra Configuration
# =============================================================================
# Additional environment variables
extraEnv: []
#   - name: CUDA_VISIBLE_DEVICES
#     value: "0"

# Additional volumes
extraVolumes: []

# Additional volume mounts
extraVolumeMounts: []
